!function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(1)},function(e,t,r){"use strict";function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,a){try{var o=t[i](a),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function o(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=r(2),l=r.n(s),c=r(5),u=(r.n(c),r(6)),p=(r.n(u),function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()),__=wp.i18n.__,h=wp.blocks.registerBlockType,f=wp.editor.InspectorControls,m=wp.components,d=m.SelectControl,v=m.TabPanel,b=wp.element.Component,g=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.state=e.constructor.getInitialState(e.props.attributes.selectedHub),e.getHubs=e.getHubs.bind(e),e.getHubs(),e.getVideos=e.getVideos.bind(e),e.getCategories=e.getCategories.bind(e),e.getCategories(),e.onChangeSelectedHub=e.onChangeSelectedHub.bind(e),e.renderTabContent=e.renderTabContent.bind(e),e}return o(t,e),p(t,null,[{key:"getInitialState",value:function(e){return{categories:[],hub:{},hubs:{},selectedHub:e,videos:{}}}}]),p(t,[{key:"getHubs",value:function(){function e(){return t.apply(this,arguments)}var t=n(l.a.mark(function e(){var t,r,n,i,a,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=wp.api.models.Post.extend({urlRoot:wpApiSettings.root+"/hub",defaults:{type:"hub"}}),r=wp.api.collections.Posts.extend({url:wpApiSettings.root+wpApiSettings.versionString+"hub",model:t}),n=new r,e.next=5,n.fetch({data:{per_page:100}});case 5:return i=e.sent,a={},i.forEach(function(e){a[e.id]=e.title.rendered}),Object.keys(a).length>0&&0!==this.state.selectedHub?(o=a[this.state.selectedHub],this.setState({hub:o,hubs:a})):this.setState({hubs:a}),e.next=11,this.props.setAttributes({hubs:a});case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"getCategories",value:function(){function e(){return t.apply(this,arguments)}var t=n(l.a.mark(function e(){var t,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new wp.api.collections.Categories,e.next=3,t.fetch({data:{orderby:"slug",order:"asc",per_page:100}});case 3:return r=e.sent,r=r.filter(function(e){return"uncategorized"!==e.slug}),this.setState({categories:r}),e.next=8,this.props.setAttributes({categories:r});case 8:this.getVideos();case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"getVideos",value:function(){function e(){return t.apply(this,arguments)}var t=n(l.a.mark(function e(){var t,r,n,i,a,o=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=wp.api.models.Post.extend({urlRoot:wpApiSettings.root+"/video",defaults:{type:"video"}}),r=wp.api.collections.Posts.extend({url:wpApiSettings.root+wpApiSettings.versionString+"video",model:t}),n=new r,e.next=5,n.fetch({data:{per_page:100}});case 5:i=e.sent,a={},i.filter(function(e){return"publish"===e.status}).forEach(function(e){var t={id:e.id,link:e.link,title:e.title.rendered,excerpt:e.excerpt.rendered,categories:e.categories,url:e.acf.video_url,runtime:e.acf.video_runtime,order:e.acf.video_order||100,subvideos:e.acf.video_repeater&&e.acf.video_repeater.map(function(e){return{link:e.subvideo_url,runtime:e.subvideo_runtime,title:e.subvideo_title,thumb:e.subvideo_custom_thumbnail.sizes.medium}}),hubs:e.acf.which_hubs.map(function(e){return e.ID}),thumb:e.uagb_featured_image_src.medium[0]};e.categories.forEach(function(e){if(1!==e){var r=o.state.categories.findIndex(function(t){return t.id===e});-1!==r&&(a[r]||(a[r]={}),a[r][t.id]=t)}})}),this.setState({videos:a});case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"onChangeSelectedHub",value:function(){function e(_x){return t.apply(this,arguments)}var t=n(l.a.mark(function e(t){var r,n,i,a,o,s,c=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===(r=parseInt(t))){e.next=12;break}n=this.state.hubs[r],this.setState({hub:n,selectedHub:r}),i=[],a={},o=function(e){i[e]=c.state.categories[e];var t={};Object.values(c.state.videos[e]).forEach(function(e){(0===r||e.hubs.includes(r))&&(t[e.id]=e)}),Object.keys(t).length>0&&(a[e]=t)};for(s in this.state.videos)o(s);return e.next=10,this.props.setAttributes({categories:i,selectedHub:r,videos:a});case 10:e.next=14;break;case 12:return e.next=14,this.props.setAttributes({categories:[],selectedHub:r,videos:{}});case 14:case"end":return e.stop()}},e,this)}));return e}()},{key:"renderTabs",value:function(){var e=this;return Object.keys(this.props.attributes.videos).map(function(t){var r=void 0,n=e.props.attributes.categories[t]||!1;return n&&(r={id:t,name:n.slug,title:n.name,className:"tab-"+t,videos:e.props.attributes.videos[t]}),r})}},{key:"renderTabContent",value:function(e){var t=this,r=Object.values(e.videos).map(function(e){var r=void 0;if(e.subvideos){var n=e.subvideos.map(function(t){return wp.element.createElement("div",{className:"subvid",key:t.link},wp.element.createElement("a",{href:e.link+"?skip_ahead="+t.link},wp.element.createElement("img",{src:t.thumb,alt:t.title})),wp.element.createElement("h1",{dangerouslySetInnerHTML:{__html:t.title}}),wp.element.createElement("p",null,__("Length: ")+t.runtime))});r=wp.element.createElement("div",{className:"sub"},wp.element.createElement("h2",null,__("or skip ahead:")),wp.element.createElement("div",{className:"subvidsmask"},wp.element.createElement("div",{className:"subvids"},n,wp.element.createElement("button",{className:"subvids-scroll subvids-scroll-left"},wp.element.createElement("i",{className:"fas fa-chevron-left"})),wp.element.createElement("button",{className:"subvids-scroll subvids-scroll-right"},wp.element.createElement("i",{className:"fas fa-chevron-right"})))))}else r=wp.element.createElement("div",{className:"sub"},wp.element.createElement("h2",null,__("What It's About:")),wp.element.createElement("div",{className:"excerpt",dangerouslySetInnerHTML:{__html:e.excerpt}}));var i=t.props.attributes.hubs,a=e.hubs.map(function(e){return i[e]}).join(", ");return wp.element.createElement("section",{key:e.id},wp.element.createElement("div",{className:"full"},wp.element.createElement("a",{href:e.link},wp.element.createElement("img",{src:e.thumb,alt:e.title})),wp.element.createElement("h1",{dangerouslySetInnerHTML:{__html:e.title+" [Full Video]"}}),wp.element.createElement("p",null,__("Length: ")+e.runtime),wp.element.createElement("p",null,__("Filed under: ")+a),wp.element.createElement("a",{href:e.link,className:"view-full-video-button"},__("View Full Video"))),r)});return wp.element.createElement("div",{className:"videos",key:e.id},r)}},{key:"render",value:function(){var e=this,t=[{value:-1,label:__("Choose an audience")},{value:0,label:__("All Audiences")}];Object.keys(this.state.hubs).length>0&&Object.keys(this.state.hubs).forEach(function(r){t.push({value:r,label:e.state.hubs[r]})});var r=__("Select an audience...");if(Object.keys(this.props.attributes.videos).length>0){var n=this.renderTabs();r=wp.element.createElement(v,{className:"topics",activeClass:"active-tab",key:"topics-tabs",tabs:n},this.renderTabContent)}return[!!this.props.isSelected&&wp.element.createElement(f,null,wp.element.createElement(d,{value:this.props.attributes.selectedHub,label:__("Target Audience"),options:t,onChange:this.onChangeSelectedHub})),r]}}]),t}(b);h("morphatic/if-incourage-topic-selector",{title:__("Topic Selector"),icon:"video-alt",category:"widgets",attributes:{categories:{type:"array",default:[]},hubs:{type:"object",default:{}},selectedHub:{type:"number",default:-1},videos:{type:"object",default:{}}},edit:g,save:function(e){var t=e.attributes,r=t.categories,n=t.hubs,i=t.videos;if(Object.keys(i).length>0){var a=Object.keys(i),o=a.map(function(e,t){var n=r[e]||!1;return wp.element.createElement("button",{type:"button",role:"tab",key:n.slug,id:n.slug,className:"components-button tab tab-"+t+(0===t?" active-tab":"")},n.name)}),s=wp.element.createElement("div",{role:"tablist","aria-orientation":"horizontal",className:"components-tab-panel__tabs"},o),l=function(e,t){return e.order<t.order?-1:e.order>t.order?1:0},c=a.map(function(e,t){var r=Object.values(i[e]).sort(l).map(function(e){var t=void 0;if(e.subvideos){var r=e.subvideos.map(function(e){return wp.element.createElement("div",{className:"subvid",key:e.link},wp.element.createElement("a",{"data-lity":!0,href:e.link},wp.element.createElement("img",{src:e.thumb,alt:e.title})),wp.element.createElement("h1",{dangerouslySetInnerHTML:{__html:e.title}}),wp.element.createElement("p",null,__("Length: ")+e.runtime))});t=wp.element.createElement("div",{className:"sub"},wp.element.createElement("h2",null,__("or skip ahead:")),wp.element.createElement("div",{className:"subvidsmask"},wp.element.createElement("div",{className:"subvids"},r,wp.element.createElement("button",{className:"subvids-scroll subvids-scroll-left"},wp.element.createElement("i",{className:"fas fa-chevron-left"})),wp.element.createElement("button",{className:"subvids-scroll subvids-scroll-right"},wp.element.createElement("i",{className:"fas fa-chevron-right"})))))}else t=wp.element.createElement("div",{className:"sub"},wp.element.createElement("h2",null,__("What It's About:")),wp.element.createElement("div",{className:"excerpt",dangerouslySetInnerHTML:{__html:e.excerpt}}));var i=e.hubs.map(function(e){return n[e]}).join(", ");return wp.element.createElement("section",{key:e.id},wp.element.createElement("div",{className:"full"},wp.element.createElement("a",{href:e.link},wp.element.createElement("img",{src:e.thumb,alt:e.title})),wp.element.createElement("h1",{dangerouslySetInnerHTML:{__html:e.title+" [Full Video]"}}),wp.element.createElement("p",null,__("Length: ")+e.runtime),wp.element.createElement("p",null,__("Filed under: ")+i),wp.element.createElement("a",{href:e.link,className:"view-full-video-button"},__("View Full Video"))),t)});return wp.element.createElement("div",{className:"videos tab-"+t+(0===t?" active":""),key:e.id},r)});return wp.element.createElement("div",{className:"topics"},wp.element.createElement("button",{className:"tabs-scroll tabs-scroll-left"},wp.element.createElement("i",{className:"fas fa-chevron-double-left"})),wp.element.createElement("button",{className:"tabs-scroll tabs-scroll-right"},wp.element.createElement("i",{className:"fas fa-chevron-double-right"})),s,c)}}})},function(e,t,r){e.exports=r(3)},function(e,t,r){var n=function(){return this}()||Function("return this")(),i=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,a=i&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(4),i)n.regeneratorRuntime=a;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";function r(e,t,r,n){var a=t&&t.prototype instanceof i?t:i,o=Object.create(a.prototype),s=new f(n||[]);return o._invoke=c(e,r,s),o}function n(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function i(){}function a(){}function o(){}function s(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function l(e){function t(r,i,a,o){var s=n(e[r],e,i);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"===typeof c&&g.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,a,o)},function(e){t("throw",e,a,o)}):Promise.resolve(c).then(function(e){l.value=e,a(l)},o)}o(s.arg)}function r(e,r){function n(){return new Promise(function(n,i){t(e,r,n,i)})}return i=i?i.then(n,n):n()}var i;this._invoke=r}function c(e,t,r){var i=N;return function(a,o){if(i===O)throw new Error("Generator is already running");if(i===j){if("throw"===a)throw o;return d()}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var l=u(s,r);if(l){if(l===S)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===N)throw i=j,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=O;var c=n(e,t,r);if("normal"===c.type){if(i=r.done?j:L,c.arg===S)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=j,r.method="throw",r.arg=c.arg)}}}function u(e,t){var r=e.iterator[t.method];if(r===v){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=v,u(e,t),"throw"===t.method))return S;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var i=n(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,S;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=v),t.delegate=null,S):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,S)}function p(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function h(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function f(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(p,this),this.reset(!0)}function m(e){if(e){var t=e[w];if(t)return t.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(g.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=v,t.done=!0,t};return n.next=n}}return{next:d}}function d(){return{value:v,done:!0}}var v,b=Object.prototype,g=b.hasOwnProperty,y="function"===typeof Symbol?Symbol:{},w=y.iterator||"@@iterator",E=y.asyncIterator||"@@asyncIterator",x=y.toStringTag||"@@toStringTag",_="object"===typeof e,k=t.regeneratorRuntime;if(k)return void(_&&(e.exports=k));k=t.regeneratorRuntime=_?e.exports:{},k.wrap=r;var N="suspendedStart",L="suspendedYield",O="executing",j="completed",S={},H={};H[w]=function(){return this};var T=Object.getPrototypeOf,P=T&&T(T(m([])));P&&P!==b&&g.call(P,w)&&(H=P);var C=o.prototype=i.prototype=Object.create(H);a.prototype=C.constructor=o,o.constructor=a,o[x]=a.displayName="GeneratorFunction",k.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===a||"GeneratorFunction"===(t.displayName||t.name))},k.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,x in e||(e[x]="GeneratorFunction")),e.prototype=Object.create(C),e},k.awrap=function(e){return{__await:e}},s(l.prototype),l.prototype[E]=function(){return this},k.AsyncIterator=l,k.async=function(e,t,n,i){var a=new l(r(e,t,n,i));return k.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},s(C),C[x]="Generator",C[w]=function(){return this},C.toString=function(){return"[object Generator]"},k.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},k.values=m,f.prototype={constructor:f,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(h),!e)for(var t in this)"t"===t.charAt(0)&&g.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=v)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,n){return a.type="throw",a.arg=e,r.next=t,n&&(r.method="next",r.arg=v),!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],a=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var o=g.call(i,"catchLoc"),s=g.call(i,"finallyLoc");if(o&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&g.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,S):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),S},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),h(r),S}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;h(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:m(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=v),S}}}(function(){return this}()||Function("return this")())},function(e,t){},function(e,t){}]);