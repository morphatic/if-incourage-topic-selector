!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n(1)},function(e,t,n){"use strict";function r(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(i,o){try{var a=t[i](o),s=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}return r("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function a(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(2),u=n.n(s),c=n(5),l=(n.n(c),n(6)),p=(n.n(l),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),__=wp.i18n.__,h=wp.blocks.registerBlockType,f=wp.editor.InspectorControls,m=wp.components,d=m.SelectControl,v=m.TabPanel,b=wp.element.Component,g=function(e){function t(){i(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.state=e.constructor.getInitialState(e.props.attributes.selectedHub),e.getHubs=e.getHubs.bind(e),e.getHubs(),e.getVideos=e.getVideos.bind(e),e.getCategories=e.getCategories.bind(e),e.getCategories(),e.onChangeSelectedHub=e.onChangeSelectedHub.bind(e),e.renderTabContent=e.renderTabContent.bind(e),e}return a(t,e),p(t,null,[{key:"getInitialState",value:function(e){return{categories:{},hub:{},hubs:{},selectedHub:e,videos:{}}}}]),p(t,[{key:"getHubs",value:function(){function e(){return t.apply(this,arguments)}var t=r(u.a.mark(function e(){var t,n,r,i,o,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=wp.api.models.Post.extend({urlRoot:wpApiSettings.root+"/hub",defaults:{type:"hub"}}),n=wp.api.collections.Posts.extend({url:wpApiSettings.root+wpApiSettings.versionString+"hub",model:t}),r=new n,e.next=5,r.fetch({data:{per_page:100}});case 5:return i=e.sent,o={},i.forEach(function(e){o[e.id]=e.title.rendered}),Object.keys(o).length>0&&0!==this.state.selectedHub?(a=o[this.state.selectedHub],this.setState({hub:a,hubs:o})):this.setState({hubs:o}),e.next=11,this.props.setAttributes({hubs:o});case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"getCategories",value:function(){function e(){return t.apply(this,arguments)}var t=r(u.a.mark(function e(){var t,n,r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new wp.api.collections.Categories,e.next=3,t.fetch({data:{per_page:100}});case 3:return n=e.sent,n=n.filter(function(e){return"uncategorized"!==e.slug}),r={},n.forEach(function(e){r[e.id]=e}),this.setState({categories:r}),e.next=10,this.props.setAttributes({categories:r});case 10:this.getVideos();case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"getVideos",value:function(){function e(){return t.apply(this,arguments)}var t=r(u.a.mark(function e(){var t,n,r,i,o,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=wp.api.models.Post.extend({urlRoot:wpApiSettings.root+"/video",defaults:{type:"video"}}),n=wp.api.collections.Posts.extend({url:wpApiSettings.root+wpApiSettings.versionString+"video",model:t}),r=new n,e.next=5,r.fetch({data:{per_page:100}});case 5:i=e.sent,o=function(e){return e.match(/v=([^&]+)/)[1]},a={},i.filter(function(e){return"publish"===e.status}).forEach(function(e){var t={id:e.id,link:e.link,title:e.title.rendered,excerpt:e.excerpt.rendered,categories:e.categories,url:e.acf.video_url,runtime:e.acf.video_runtime,subvideos:e.acf.video_repeater&&e.acf.video_repeater.map(function(e){return{link:o(e.subvideo_url),runtime:e.subvideo_runtime,title:e.subvideo_title,thumb:e.subvideo_custom_thumbnail.sizes.medium}}),hubs:e.acf.which_hubs.map(function(e){return e.ID}),thumb:e.uagb_featured_image_src.medium[0]};e.categories.forEach(function(e){1!==e&&(a[e]||(a[e]={}),a[e][t.id]=t)})}),this.setState({videos:a});case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"onChangeSelectedHub",value:function(){function e(_x){return t.apply(this,arguments)}var t=r(u.a.mark(function e(t){var n,r,i,o,a,s,c=this;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=parseInt(t),r=this.state.hubs[n],this.setState({hub:r,selectedHub:n}),i={},o={},a=function(e){i[e]=c.state.categories[e];var t={};Object.values(c.state.videos[e]).forEach(function(e){(0===n||e.hubs.includes(n))&&(t[e.id]=e)}),Object.keys(t).length>0&&(o[e]=t)};for(s in this.state.videos)a(s);return e.next=9,this.props.setAttributes({categories:i,selectedHub:n,videos:o});case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"renderTabs",value:function(){var e=this;return Object.keys(this.props.attributes.videos).map(function(t){var n=e.props.attributes.categories[t]||!1;return n?{id:t,name:n.slug,title:n.name,className:"tab-"+t,videos:e.props.attributes.videos[t]}:{id:t,name:"something",title:"something",className:"tab-"+t,videos:[]}})}},{key:"renderTabContent",value:function(e){var t=this,n=Object.values(e.videos).map(function(e){var n=void 0;if(e.subvideos){var r=e.subvideos.map(function(t){return wp.element.createElement("div",{className:"subvid",key:t.link},wp.element.createElement("a",{href:e.link+"?skip_ahead="+t.link},wp.element.createElement("img",{src:t.thumb,alt:t.title})),wp.element.createElement("h1",{dangerouslySetInnerHTML:{__html:t.title}}),wp.element.createElement("p",null,__("Length: ")+t.runtime))});n=wp.element.createElement("div",{className:"sub"},wp.element.createElement("h2",null,__("or skip ahead:")),wp.element.createElement("div",{className:"subvidsmask"},wp.element.createElement("div",{className:"subvids"},r)))}else n=wp.element.createElement("div",{className:"sub"},wp.element.createElement("h2",null,__("description:")),wp.element.createElement("div",{dangerouslySetInnerHTML:{__html:e.excerpt}}));var i=t.props.attributes.hubs,o=e.hubs.map(function(e){return i[e]}).join(", ");return wp.element.createElement("section",{key:e.id},wp.element.createElement("div",{className:"full"},wp.element.createElement("a",{href:e.link},wp.element.createElement("img",{src:e.thumb,alt:e.title})),wp.element.createElement("h1",{dangerouslySetInnerHTML:{__html:e.title+"<br>[Full Video]"}}),wp.element.createElement("p",null,__("Length: ")+e.runtime),wp.element.createElement("p",null,__("Filed under: ")+o),wp.element.createElement("a",{href:e.link,className:"view-full-video-button"},__("View Full Video"))),n)});return wp.element.createElement("div",{className:"videos",key:e.id},n)}},{key:"render",value:function(){var e=this,t=[{value:0,label:__("All Audiences")}];Object.keys(this.state.hubs).length>0&&Object.keys(this.state.hubs).forEach(function(n){t.push({value:n,label:e.state.hubs[n]})});var n=__("Loading Videos...");if(Object.keys(this.props.attributes.videos).length>0){var r=this.renderTabs();n=wp.element.createElement(v,{className:"topics",activeClass:"active-tab",key:"topics-tabs",tabs:r},this.renderTabContent)}return[!!this.props.isSelected&&wp.element.createElement(f,null,wp.element.createElement(d,{value:this.props.attributes.selectedHub,label:__("Target Audience"),options:t,onChange:this.onChangeSelectedHub})),n]}}]),t}(b);h("morphatic/if-incourage-topic-selector",{title:__("Topic Selector"),icon:"video-alt",category:"widgets",attributes:{categories:{type:"object",default:{}},hubs:{type:"object",default:{}},selectedHub:{type:"number",default:0},videos:{type:"object",default:{}}},edit:g,save:function(e){var t=e.attributes,n=t.categories,r=t.hubs,i=t.videos;if(Object.keys(i).length>0){var o=Object.keys(i).map(function(e){var t=n[e]||!1;return wp.element.createElement("button",{type:"button",role:"tab",key:t.slug,id:t.slug,className:"components-button tab"},t.name)}),a=wp.element.createElement("div",{role:"tablist","aria-orientation":"horizontal",className:"components-tab-panel__tabs"},o),s=Object.keys(i).map(function(e){var t=Object.values(i[e]).map(function(e){var t=void 0;if(e.subvideos){var n=e.subvideos.map(function(t){return wp.element.createElement("div",{className:"subvid",key:t.link},wp.element.createElement("a",{href:e.link+"?skip_ahead="+t.link},wp.element.createElement("img",{src:t.thumb,alt:t.title})),wp.element.createElement("h1",{dangerouslySetInnerHTML:{__html:t.title}}),wp.element.createElement("p",null,__("Length: ")+t.runtime))});t=wp.element.createElement("div",{className:"sub"},wp.element.createElement("h2",null,__("or skip ahead:")),wp.element.createElement("div",{className:"subvidsmask"},wp.element.createElement("div",{className:"subvids"},n)))}else t=wp.element.createElement("div",{className:"sub"},wp.element.createElement("h2",null,__("description:")),wp.element.createElement("div",{dangerouslySetInnerHTML:{__html:e.excerpt}}));var i=e.hubs.map(function(e){return r[e]}).join(", ");return wp.element.createElement("section",{key:e.id},wp.element.createElement("div",{className:"full"},wp.element.createElement("a",{href:e.link},wp.element.createElement("img",{src:e.thumb,alt:e.title})),wp.element.createElement("h1",{dangerouslySetInnerHTML:{__html:e.title+"<br>[Full Video]"}}),wp.element.createElement("p",null,__("Length: ")+e.runtime),wp.element.createElement("p",null,__("Filed under: ")+i),wp.element.createElement("a",{href:e.link,className:"view-full-video-button"},__("View Full Video"))),t)});return wp.element.createElement("div",{className:"videos",key:e.id},t)});return wp.element.createElement("div",{className:"topics"},a,s)}}})},function(e,t,n){e.exports=n(3)},function(e,t,n){var r=function(){return this}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,o=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(4),i)r.regeneratorRuntime=o;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";function n(e,t,n,r){var o=t&&t.prototype instanceof i?t:i,a=Object.create(o.prototype),s=new f(r||[]);return a._invoke=c(e,n,s),a}function r(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function i(){}function o(){}function a(){}function s(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function u(e){function t(n,i,o,a){var s=r(e[n],e,i);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"===typeof c&&g.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):Promise.resolve(c).then(function(e){u.value=e,o(u)},a)}a(s.arg)}function n(e,n){function r(){return new Promise(function(r,i){t(e,n,r,i)})}return i=i?i.then(r,r):r()}var i;this._invoke=n}function c(e,t,n){var i=L;return function(o,a){if(i===O)throw new Error("Generator is already running");if(i===S){if("throw"===o)throw a;return d()}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var u=l(s,n);if(u){if(u===N)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===L)throw i=S,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=O;var c=r(e,t,n);if("normal"===c.type){if(i=n.done?S:j,c.arg===N)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=S,n.method="throw",n.arg=c.arg)}}}function l(e,t){var n=e.iterator[t.method];if(n===v){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=v,l(e,t),"throw"===t.method))return N;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return N}var i=r(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,N;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=v),t.delegate=null,N):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,N)}function p(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function h(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function f(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(p,this),this.reset(!0)}function m(e){if(e){var t=e[w];if(t)return t.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(g.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=v,t.done=!0,t};return r.next=r}}return{next:d}}function d(){return{value:v,done:!0}}var v,b=Object.prototype,g=b.hasOwnProperty,y="function"===typeof Symbol?Symbol:{},w=y.iterator||"@@iterator",E=y.asyncIterator||"@@asyncIterator",_=y.toStringTag||"@@toStringTag",k="object"===typeof e,x=t.regeneratorRuntime;if(x)return void(k&&(e.exports=x));x=t.regeneratorRuntime=k?e.exports:{},x.wrap=n;var L="suspendedStart",j="suspendedYield",O="executing",S="completed",N={},T={};T[w]=function(){return this};var H=Object.getPrototypeOf,P=H&&H(H(m([])));P&&P!==b&&g.call(P,w)&&(T=P);var C=a.prototype=i.prototype=Object.create(T);o.prototype=C.constructor=a,a.constructor=o,a[_]=o.displayName="GeneratorFunction",x.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},x.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_ in e||(e[_]="GeneratorFunction")),e.prototype=Object.create(C),e},x.awrap=function(e){return{__await:e}},s(u.prototype),u.prototype[E]=function(){return this},x.AsyncIterator=u,x.async=function(e,t,r,i){var o=new u(n(e,t,r,i));return x.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},s(C),C[_]="Generator",C[w]=function(){return this},C.toString=function(){return"[object Generator]"},x.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},x.values=m,f.prototype={constructor:f,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(h),!e)for(var t in this)"t"===t.charAt(0)&&g.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=v)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,r){return o.type="throw",o.arg=e,n.next=t,r&&(n.method="next",n.arg=v),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var a=g.call(i,"catchLoc"),s=g.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&g.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,N):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),N},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),h(n),N}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;h(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:m(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=v),N}}}(function(){return this}()||Function("return this")())},function(e,t){},function(e,t){}]);